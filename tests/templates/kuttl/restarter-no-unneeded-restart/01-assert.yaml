---
apiVersion: kuttl.dev/v1beta1
kind: TestAssert
timeout: 180
commands:
  - script: |
      kubectl -n $NAMESPACE rollout status sts/early --timeout=5m

      read n1 t1 n2 t2 n3 t3 < <(
        kubectl -n $NAMESPACE get pod early-{1,2,0} \
          -o jsonpath='{range .items[*]}{.metadata.name}{" "}{.metadata.creationTimestamp}{" "}{end}'
      )

      if [[ "$t1" > "$t2" || "$t2" > "$t3" ]]; then
        echo "ERROR: Pod creation order invalid:"
        printf "  %s: %s\n  %s: %s\n  %s: %s\n" "$n1" "$t1" "$n2" "$t2" "$n3" "$t3"
        exit 1
      fi

      echo "OK: Pod creation order verified:"
      printf "  %s (%s)\n  %s (%s)\n  %s (%s)\n" "$n1" "$t1" "$n2" "$t2" "$n3" "$t3"
      echo "  Asserted: $n1 <= $n2 <= $n3"
